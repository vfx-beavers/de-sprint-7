Егор, доброе утро. 

Спасибо за подробное описание.
Пересобрал с учётом замечаний. Прошу, посмотри новую версию.






