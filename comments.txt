Егор, доброе утро. 

Спасибо за советы. В том числе за идею с изначальным расширением csv, при которой было бы всё проще.
Прошу, посмотри новую версию. Большая часть замечаний учтена.
Персисты вынес. Лишние отладки закоментил. Лишняя переменная в препроцессе была только для последующего принта пути. 
По сути тоже остатки отладки. Препроцесс перебрал. Сам даг в целом до отправки проходил без падений.
Собрано понятно это всё абы как, лишь бы работало из кусков 7 спринта, пачки и гугла.
В частности оттуда брался кросс всех на всех с последующей очисткой. Пробовал вариант через explode. Вроде то же самое.
В остальном с проектом неделю и уже откровенно плыву. Только сейчас понял когда ошибки свои, а когда отпала инфраструктура.

Прошу помощи или более подробного пояснения с основным замечанием.


upd: только под утро увидел основное сообщение с замечанием про селекты. 
     Сегодня после обеда проверю добавлю.


